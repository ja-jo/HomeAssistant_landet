homeassistant:
  # Name of the location where Home Assistant is running
  name: Jans automatiska burk
  # Location required to calculate the time the sun rises and sets
  latitude: 59.6631
  longitude: 18.6004
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: 11
  # metric for Metric, imperial for Imperial
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: Europe/Stockholm
  # Customization file
  customize: !include customize.yaml

# Show links to resources in log and frontend
#introduction:

# Enables the frontend
frontend:

# Enables configuration UI
config:

http:
  # Secrets are defined in the file secrets.yaml
  #api_password: !secret http_password
  # Uncomment this if you are using SSL/TLS, running in Docker container, etc.
  # base_url: example.duckdns.org:8123
#  base_url: jans-landet.asuscomm.com:8123
  #base_url: https://jans-landet.asuscomm.com:8123
  #base_url: https://my-domain.duckdns.org:8123
  #ssl_certificate: /home/homeassistant/.ssl/cert.pem
  #ssl_key: /home/homeassistant/.ssl/key.pem
  #ssl_certificate: /ssl/cert.pem
  #ssl_key: /ssl/key.pem
#  ssl_certificate: /home/homeassistant/.homeassistant/ssl/cert.pem
#  ssl_key: /home/homeassistant/.homeassistant/ssl/key.pem
  #ssl_key: /ssl/privkey.pem

# Checks for available updates
# Note: This component will send some information about your system to
# the developers to assist with development of Home Assistant.
# For more information, please see:
# https://home-assistant.io/blog/2016/10/25/explaining-the-updater/

updater:
  # Optional, allows Home Assistant developers to focus on popular components.
  # include_used_components: true

# Discover some devices automatically
discovery:
  ignore:
    - yeelight

# Allows you to issue voice commands from the frontend in enabled browsers
#conversation:

# Enables support for tracking state changes over time
history:

# Hur lange skall data sparas
recorder:
  purge_keep_days: 20

# View all events in a logbook
logbook:

system_log:
  fire_event: true

# Monitor raspberry
glances:

# The System Health component provides an API to offer information on the system and its components.
# It also allows to run diagnostic tools to diagnose problems.
system_health:

# Koppling till IFTTT
ifttt:
  key: gJ31koJur_SZMwloS4mt4

# Enables a map showing the location of tracked devices
map:

# Track the sun
sun:

#light.yeelight_color2_04cf8ca0152b:
#  friendly_name: Altan
#light.yeelink_light_color2_miio132949501:
#  friendly_name: Altan
#yeelight:
#  devices:
#    192.168.1.47:
#      name: Altan
#      transition: 1000
#      use_music_mode: true
#      save_on_change: true

# Example configuration.yaml entry
yeelight:
  devices:
    192.168.1.47:
      name: Altanlampa
      transition: 1000
      save_on_change: true


# Anvand signal for meddelanden
#notify:
#  - name: Jans-automat
#    platform: signalmessenger
#    sender_nr: "+46704842816"
#    recp_nr: "+46709828233"
#    signal_cli_path: /home/homeassistant/signal-cli-0.6.2/bin

# Weather prediction
sensor:
  - platform: systemmonitor
    resources:
      - type: disk_use_percent
        arg: /
      - type: memory_free
      - type: swap_use_percent
      - type: load_1m
      - type: load_5m
      - type: processor_use
      - type: last_boot

  - platform: yr
    monitored_conditions:
      - temperature
      - symbol
      - precipitation
      - windSpeed
      - pressure
      - windDirection
      - humidity
      - fog
#  - platform: dovado
#    username: admin
#    password: pellemaja
#    host: 192.168.0.1
#    sensors:
#      - network
  - platform: time_date
    display_options:
      - 'time'
  - platform: template
    sensors:
      veckodag:
        value_template: "{{ ['Måndag','Tisdag','Onsdag','Torsdag','Fredag','Lördag','Söndag'][now().weekday()] }}"
        entity_id: sensor.time
  - platform: template
    sensors:
      manad:
        value_template: "{{ ['Jan1','Jan','Feb','Mar','Apr','Maj','Jun','Jul','Aug','Sep','Okt','Nov','Dec'][now().month] }}"
        entity_id: sensor.time
#  - platform: onewire
#    names:
#      28-000005ad64c9: altandorr
#      28-000007a8cb66: Nr1
#      28-01131b71cfe3: Ute2
#      28-01131b790468: Inne
  - platform: template
    sensors:
      departuretime_ak:
        friendly_name: 'Timer 1'
        value_template: '{% if states.input_number.heater_ak_hour.state|round(0)|string|length == 1 %}0{% endif %}{{ states.input_number.heater_ak_hour.state|round(0)|string }}:{% if states.input_number.heater_ak_minutes.state|round(0)|string|length == 1 %}0{% endif %}{{ states.input_number.heater_ak_minutes.state|round(0)|string }}'
        entity_id: 
         - input_number.heater_ak_minutes
         - input_number.heater_ak_hour
  - platform: template
    sensors:
      departuretime_ak2:
        friendly_name: 'Timer 2'
        value_template: '{% if states.input_number.heater_ak2_hour.state|round(0)|string|length == 1 %}0{% endif %}{{ states.input_number.heater_ak2_hour.state|round(0)|string }}:{% if states.input_number.heater_ak2_minutes.state|round(0)|string|length == 1 %}0{% endif %}{{ states.input_number.heater_ak2_minutes.state|round(0)|string }}'
        entity_id: 
         - input_number.heater_ak2_minutes
         - input_number.heater_ak2_hour
  - platform: template
    sensors:
      departuretime_ak3:
        friendly_name: 'Ankomsttid'
        value_template: '{% if states.input_number.heater_ak3_hour.state|round(0)|string|length == 1 %}0{% endif %}{{ states.input_number.heater_ak3_hour.state|round(0)|string }}:{% if states.input_number.heater_ak3_minutes.state|round(0)|string|length == 1 %}0{% endif %}{{ states.input_number.heater_ak3_minutes.state|round(0)|string }}'
        entity_id: 
         - input_number.heater_ak3_minutes
         - input_number.heater_ak3_hour
  - platform: mqtt
    name: "Kallar temp"
    state_topic: "homeassistant/DHT11/tempDHT"
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "Temp ute1"
    state_topic: "homeassistant/max1/tempds1"
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "Kallar fukt"
    state_topic: "homeassistant/DHT11/fuktDHT"
    unit_of_measurement: "%"
    icon: mdi:water-percent
  - platform: mqtt
    name: "Inne temp1"
    state_topic: "homeassistant/mini1/temp1"
    unit_of_measurement: "°C"
#  - platform: mqtt
#    name: "Inne temp2"
#    state_topic: "homeassistant/mini1/temp2"
#    unit_of_measurement: "°C"
  - platform: mqtt
    name: "Xiaomi temp"
    state_topic: "homeassistant/xiaomi/sensor1/temp"
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "Xiaomi fukt"
    state_topic: "homeassistant/xiaomi/sensor1/fukt"
    unit_of_measurement: "%"
    icon: mdi:water-percent
  - platform: mqtt
    name: "Temp ute1"
    state_topic: "homeassistant/max1/tempds1"
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "Badvattentemp"
    state_topic: "homeassistant/bad1/temp1"
    unit_of_measurement: "°C"
#  - platform: template
#    sensors:
#      inne_temp2_offset:
#        value_template: '{{states.sensor.inne_temp2.state | float - 2.5}}'
#        friendly_name: 'Inne temp2 offset'
#        unit_of_measurement: "°C"
  - platform: template
    sensors:
      thermostat_status:
        friendly_name: 'Husvarme status'
        value_template: "{{ states.climate.innetemp.attributes.hvac_action }}"
#  - platform: statistics
#    name: altan statistik
#    entity_id: sensor.altandorr_temp
#    sampling_size: 4
#  - platform: template
#    sensors:
#      altandorr_temp_delta:
#        friendly_name: "Altandorr Temperatur Delta"
#        value_template: "{{ states.sensor.altandorr_statistik_mean.attributes.max_value | float - states.sensor.altandorr_statistik_mean.attributes.min_value | float }}"
#        entity_id: sensor.altandorr_statistik_mean
#        unit_of_measurement: "C"

#  - platform: smhi

# Kanner av om altandorren ar oppen
  - platform: template
    sensors:
      temp_diff:
        friendly_name: Temperature Difference
        value_template: >
          {% if ((states.sensor.inne_temp1.state | float ) - (states.sensor.temp_th16a.state | float))
            < (states.input_number.varme_on_offset.state | float ) %} varme_on
          {% elif ((states.sensor.inne_temp1.state | float ) - (states.sensor.temp_th16a.state | float))
            > (states.input_number.varme_off_offset.state | float ) %} varme_off
          {% else %} pending {% endif %}

#          {% if ((states.sensor.inne_temp1.state | float ) - (states.sensor.altandorr_temperature.state | float))
#          {% elif ((states.sensor.inne_temp1.state | float ) - (states.sensor.altandorr_temperature.state | float))
#sensor.temp_h16a

  - platform: statistics
    entity_id: sensor.inne_temp1
    name: Inne temp data
    sampling_size: 1440
    max_age:
      hours: 24

  - platform: statistics
    entity_id: sensor.temp_ute1
    name: Ute temp data
    sampling_size: 1440
    max_age:
      hours: 24

  - platform: template
    sensors:
      inne_temp_max:
        friendly_name: Inne temp max
        value_template: "{{ state_attr('sensor.inne_temp_data', 'max_value') }}"
        unit_of_measurement: '°C'
        device_class: temperature
      inne_temp_min:
        friendly_name: Inne temp min
        value_template: "{{ state_attr('sensor.inne_temp_data', 'min_value') }}"
        unit_of_measurement: '°C'
        device_class: temperature
      ute_temp_max:
        friendly_name: Ute temp max
        value_template: "{{ state_attr('sensor.ute_temp_data', 'max_value') }}"
        unit_of_measurement: '°C'
        device_class: temperature
      ute_temp_min:
        friendly_name: Ute temp min
        value_template: "{{ state_attr('sensor.ute_temp_data', 'min_value') }}"
        unit_of_measurement: '°C'
        device_class: temperature

  - platform: mqtt
    name: "Test volt1"
    state_topic: "homeassistant/volt1"
  - platform: mqtt
    name: "Test volt2"
    state_topic: "homeassistant/volt2"
  - platform: mqtt
    name: "Test volt3"
    state_topic: "homeassistant/volt3"

  - platform: mqtt
    state_topic: 'homeassistant/OpenMQTTGateway_ESP32_BLE/BTtoMQTT/582D3438050B' # MQTT topic, check MQTT messages; replace AA... with id (BLE MAC) of your device
    name: "Mijia2_temperatur"
    unit_of_measurement: '°C'
    value_template: '{{ value_json.tem | is_defined }}'
    expire_after: 21600 # 6 hours
  - platform: mqtt
    state_topic: 'homeassistant/OpenMQTTGateway_ESP32_BLE/BTtoMQTT/582D3438050B'
    name: "Mijia2_fukt"
    unit_of_measurement: '%'
    icon: mdi:water-percent
    value_template: '{{ value_json.hum | is_defined }}'
    expire_after: 21600 # 6 hours
  - platform: mqtt
    state_topic: 'homeassistant/OpenMQTTGateway_ESP32_BLE/BTtoMQTT/582D3438050B'
    name: "Mijia2_batteri"
    unit_of_measurement: '%'
    value_template: '{{ value_json.batt | is_defined }}'
    expire_after: 21600 # 6 hours

  - platform: mqtt
    state_topic: 'home/OpenMQTTGateway_ESP32_BLE/BTtoMQTT/4C65A8DDD508' # MQTT topic, check MQTT messages; replace AA... with id (BLE MAC) of your device
    name: "Mijia1_temperatur"
    unit_of_measurement: '°C'
    value_template: '{{ value_json.tem | is_defined }}'
    expire_after: 21600 # 6 hours
    device_class: temperature
  - platform: mqtt
    state_topic: 'home/OpenMQTTGateway_ESP32_BLE/BTtoMQTT/4C65A8DDD508'
    name: "Mijia1_fukt"
    unit_of_measurement: '%'
    value_template: '{{ value_json.hum | is_defined }}'
    expire_after: 21600 # 6 hours
    device_class: humidity
  - platform: mqtt
    state_topic: 'home/OpenMQTTGateway_ESP32_BLE/BTtoMQTT/4C65A8DDD508'
    name: "Mijia1_batteri"
    unit_of_measurement: '%'
    value_template: '{{ value_json.batt | is_defined }}'
    expire_after: 21600 # 6 hours
    device_class: battery

  - platform: template
    sensors:
      batteri1:
        value_template: >-
          {% if states('sensor.test_volt1')|float > 0 %}
            {{ ((states('sensor.test_volt1') | float +80.69)/326.74) | round(1) }}
          {% else %}
            0
          {% endif %}
        friendly_name: "Batteri1"
        unit_of_measurement: "V"
      batteri2:
        value_template: >-
          {% if states('sensor.test_volt2')|float > 0 %}
            {{ ((states('sensor.test_volt2') | float +157.55)/213.93) | round(1) }}
          {% else %}
            0
          {% endif %}
        friendly_name: "Batteri2"
        unit_of_measurement: "V"
      batteri3:
        value_template: >-
          {% if states('sensor.test_volt3')|float > 0 %}
            {{ ((states('sensor.test_volt3') | float +157.72)/162.48) | round(1) }}
          {% else %}
            0
          {% endif %}
        friendly_name: "Batteri3"
        unit_of_measurement: "V"

  - platform: mqtt
    name: "Temp TH16A"
    state_topic: "tele/tasmotaTH16A/SENSOR"
    value_template: "{{ value_json['DS18B20'].Temperature }}"
    unit_of_measurement: "°C"
    icon: mdi:thermometer
    availability_topic: "tele/tasmotaTH16A/LWT"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: temperature

  - platform: mqtt
    name: "Temp TH16b"
    state_topic: "tele/tasmotaTH16b/SENSOR"
    value_template: "{{ value_json['DHT11'].Temperature }}"
    unit_of_measurement: "°C"
    icon: mdi:thermometer
    availability_topic: "tele/tasmotaTH16b/LWT"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: temperature

  - platform: mqtt
    name: "Fukt TH16b"
    state_topic: "tele/tasmotaTH16b/SENSOR"
    value_template: "{{ value_json['DHT11'].Humidity }}"
    unit_of_measurement: "%"
    icon: mdi:water-percent
    availability_topic: "tele/tasmotaTH16b/LWT"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: humidity

  - platform: min_max
    round_digits: 1
    entity_ids:
      - sensor.temp_ute1
      - sensor.inne_temp1

device_tracker:
#  - platform: bluetooth_tracker
#    new_device_defaults:
#      track_new_devices: false
#  - platform: ping
#    hosts:
#      jan: 192.168.1.134
  #- platform: nmap_tracker
  #  hosts: 192.168.1.1-255
  #  exclude: 192.168.1.134
  #  interval_seconds: 30
#  - platform: asuswrt
#    host: 192.168.1.1
#    username: admin
#    password: 

asuswrt:
    host: 192.168.1.1
    username: admin
    password: !secret asus_password

#mqtt:

# Arbetsdagar
binary_sensor:
  - platform: workday
    country: SE
    workdays: [mon, tue, wed, thu, fri]

  - platform: aurora

# Anvands ej
#  - platform: trend
#    sensors:
#      altandorr_temperatur_down:
#        entity_id: sensor.altandorr_temperatur
#        invert: Yes

# Text to speech
tts:
  - platform: google_translate
    service_name: google_say

# Cloud
cloud:
mqtt:
    broker: 192.168.1.134
    username: "homeassistant"
    password: !secret mqtt_password
    discovery: true
    discovery_prefix: homeassistant

# Example configuration.yaml entry
tellstick:
  signal_repetitions: 2
switch:
  - platform: tellstick

  - platform: mqtt
    name: "Sonoff power"
    state_topic: "stat/sonoff/RESULT"
    value_template: "{{ value_json.POWER }}"
    command_topic: "cmnd/sonoff/POWER"
    availability_topic: "tele/sonoff/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "Slampher power"
    state_topic: "stat/slampher/RESULT"
    value_template: "{{ value_json.POWER }}"
    command_topic: "cmnd/slampher/POWER"
    availability_topic: "tele/slampher/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "SonoffBasic power"
    state_topic: "stat/sonoffbasic/RESULT"
    value_template: "{{ value_json.POWER }}"
    command_topic: "cmnd/sonoffbasic/POWER"
    availability_topic: "tele/sonoffbasic/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "SonoffBasic4"
    state_topic: "stat/SonoffBasic4/RESULT"
    value_template: "{{ value_json.POWER }}"
    command_topic: "cmnd/SonoffBasic4/POWER"
    availability_topic: "tele/SonoffBasic4/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "SonoffBasic5"
    state_topic: "stat/SonoffBasic5/RESULT"
    value_template: "{{ value_json.POWER }}"
    command_topic: "cmnd/SonoffBasic5/POWER"
    availability_topic: "tele/SonoffBasic5/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "SonoffTH16A"
    state_topic: "stat/tasmotaTH16A/RESULT"
    value_template: "{{ value_json.POWER }}"
    command_topic: "cmnd/tasmotaTH16A/POWER"
    availability_topic: "tele/tasmotaTH16A/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "SonoffTH16B power"
    state_topic: "stat/tasmotaTH16b/RESULT"
    value_template: "{{ value_json.POWER }}"
    command_topic: "cmnd/tasmotaTH16b/POWER"
    availability_topic: "tele/tasmotaTH16b/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

group: !include groups.yaml

automation: !include automations.yaml

automation 2: !include jans_auto.yaml

script: !include scripts.yaml

climate:
  - platform: generic_thermostat
    name: Innetemp
    #heater: group.varme
    heater: switch.sonoffth16a
    target_sensor: sensor.inne_temp1
    #target_sensor: sensor.altandorr_temperature
    #target_temp: 4
    min_temp: 4
    max_temp: 30
    #precision: 1.0
    initial_hvac_mode: "heat"
    #initial_operation_mode: "auto"
    min_cycle_duration:
      minutes: 10

  - platform: generic_thermostat
    name: Gaststuga
    heater: switch.sonoffth16b_power
    target_sensor: sensor.temp_th16b
    min_temp: 4
    max_temp: 30
    initial_hvac_mode: "off"
    min_cycle_duration:
      minutes: 10

# Input section
input_number:
  heater_ak_hour:
    name: Timme
    icon: mdi:timer
    #initial: 17
    min: 0
    max: 23
    step: 1
  
  heater_ak_minutes:
    name: Minut
    icon: mdi:timer
    #initial: 00
    min: 0
    max: 55
    step: 5

  heater_ak2_hour:
    name: Timme
    icon: mdi:timer
    #initial: 17
    min: 0
    max: 23
    step: 1
  
  heater_ak2_minutes:
    name: Minut
    icon: mdi:timer
    #initial: 00
    min: 0
    max: 55
    step: 5

  heater_ak3_hour:
    name: Timme
    icon: mdi:timer
    #initial: 17
    min: 0
    max: 23
    step: 1
  
  heater_ak3_minutes:
    name: Minut
    icon: mdi:timer
    #initial: 00
    min: 0
    max: 55
    step: 5
  
  heating_temperature:
    name: Temperatur
    min: 4
    max: 25
    step: 1
    icon: mdi:thermometer

  heating_temperature2:
    name: Temperatur2
    min: 4
    max: 25
    step: 1
    icon: mdi:thermometer

  heating_temperature3:
    name: Temperatur3
    min: 4
    max: 25
    step: 1
    icon: mdi:thermometer

  heating_temperatur_hem:
    name: Temperatur hemfard
    min: 4
    max: 25
    step: 1
    icon: mdi:thermometer

  heating_dag:
    name: Dag
    initial: 21
    min: 4
    max: 25
    step: 1
    icon: mdi:thermometer

  heating_natt:
    name: Natt
    initial: 18
    min: 4
    max: 25
    step: 1
    icon: mdi:thermometer

  varme_on_offset:
    name: ON offset
    initial: 2
    min: 0
    max: 10
    step: 0.5

  varme_off_offset:
    name: OFF offset
    initial: 3
    min: 0
    max: 10
    step: 0.5

input_boolean:
  heating_timer:
    name: Timer1
    icon: mdi:toggle-switch

  heating_timer2:
    name: Timer2
    icon: mdi:toggle-switch

  heating_timer3:
    name: Timer3
    icon: mdi:toggle-switch

  av_lamnar:
    name: Av vid hemfard
    icon: mdi:toggle-switch

  nattsankning_switch:
    name: Nattsankning
    icon: mdi:toggle-switch

tuya:
  username: ja-jo@bredband.net
  password: !secret tuya_password
  country_code: 46
  platform: tuya

history_graph:
  gr1:
    name: Tempgraf
    entities:
      - sensor.inne_temperature
      - sensor.ute_temperature
      - sensor.yr_temperature
      - sensor.kallar_temp
      - sensor.inne_temp1
      - sensor.temp_ute1
      - sensor.mijia1_temperatur
#      - sensor.altandorr_temperature
      - sensor.temp_th16a
      - sensor.temp_th16b
    hours_to_show: 24
    refresh: 60

# Sensor section
#sensor:
#  - platform: template
#    sensors:
#      departuretime_ak:
#        friendly_name: 'Ankomsttid'
#        value_template: '{% if states.input_number.heater_ak_hour.state|round(0)|string|length == 1 %}0{% endif %}{{ states.input_number.heater_ak_hour.state|round(0)|string }}:{% if states.input_number.heater_ak_minutes.state|round(0)|string|length == 1 %}0{% endif %}{{ states.input_number.heater_ak_minutes.state|round(0)|string }}'
#        entity_id: 
#         - input_number.heater_ak_minutes
#         - input_number.heater_ak_hour
#

